<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Checkout</title>
  <link rel="stylesheet" href="css/styles.css" />
</head>
<body>
  <header class="nav">
    <div class="nav-inner">
      <div class="brand">
        <span style="width:12px;height:12px;border-radius:99px;background:linear-gradient(135deg,var(--accent),var(--accent2));display:inline-block"></span>
        <span id="bizName">Checkout</span>
      </div>

      <div style="display:flex; gap:10px; align-items:center">
        <a class="btn secondary" href="index.html">‚Üê Back</a>
      </div>
    </div>
  </header>

  <main class="container">
    <section class="h-card">
      <h1 style="font-size:30px;margin:0 0 6px">Checkout</h1>
      <p>Submit your order details.</p>

      <div id="orderSummary" class="notice" style="margin:14px 0"></div>

      <!-- ‚úÖ FIXED: removed duplicate id attribute -->
      <form class="form"
        id="checkoutForm"
        action="https://formsubmit.co/khiljiasad2@gmail.com"
        method="POST">

        <!-- ‚úÖ ADDED: FormSubmit options -->
        <input type="hidden" name="_subject" value="New Checkout Order" />
        <input type="hidden" name="_template" value="table" />
        <input type="hidden" name="_captcha" value="false" />
        <!-- Optional redirect after submit -->
        <input type="hidden" name="_next" value="index.html" />

        <!-- ‚úÖ ADDED: these are what will carry items into the email -->
        <input type="hidden" name="order_items" id="order_items" />
        <input type="hidden" name="order_total" id="order_total" />

        <div class="two">
          <input class="input" name="name" placeholder="Full name" required />
          <input class="input" name="email" type="email" placeholder="Your email" required />
        </div>

        <div class="two">
          <input class="input" name="phone" placeholder="Phone (optional)" />
          <input class="input" name="company" placeholder="Company (optional)" />
        </div>

        <textarea class="input" name="notes" placeholder="Notes / details (sizes, page count, links, brand colors, etc.)"></textarea>

        <button class="btn" type="submit" id="submitBtn">Submit Order (Email)</button>

        <div class="small"></div>
      </form>
    </section>

    <div class="footer">
      Tip: if the email window doesn‚Äôt open, your browser may block popups‚Äîallow it or copy the order text.
    </div>
  </main>

  <!-- ‚úÖ ADDED: populate hidden fields with cart data BEFORE submit -->
  <script>
    // üî• IMPORTANT: set this to the same key your cart uses in checkout.js/index.js
    const CART_KEY = "cart";

    function readCart() {
      // Try localStorage first, then sessionStorage
      const raw =
        localStorage.getItem(CART_KEY) ||
        sessionStorage.getItem(CART_KEY);

      if (!raw) return [];

      try {
        const parsed = JSON.parse(raw);
        // Support either array cart OR object with items array
        if (Array.isArray(parsed)) return parsed;
        if (parsed && Array.isArray(parsed.items)) return parsed.items;
        return [];
      } catch (e) {
        return [];
      }
    }

    function formatMoney(n) {
      const num = Number(n || 0);
      return "$" + num.toFixed(2);
    }

    function buildSummary(items) {
      // Supports several common cart shapes:
      // item.name/title/service, item.qty/quantity, item.price/amount
      let total = 0;

      const lines = items.map((item, idx) => {
        const name = item.name || item.title || item.service || `Item ${idx + 1}`;
        const qty = Number(item.qty || item.quantity || 1);
        const price = Number(item.price || item.amount || 0);
        const lineTotal = qty * price;
        total += lineTotal;

        // If your cart has no per-item price, it will still list items/qty.
        const pricePart = price ? ` ‚Äî ${formatMoney(price)} each` : "";
        return `${name} x${qty}${pricePart}`;
      });

      return { text: lines.join("\n"), total };
    }

    // Show summary on page AND fill hidden fields
    function syncOrderFields() {
      const items = readCart();
      const emptyNotice = document.getElementById("emptyNotice");
      const orderSummary = document.getElementById("orderSummary");

      if (!items || items.length === 0) {
        emptyNotice.style.display = "block";
        orderSummary.textContent = "No items found in cart.";
        document.getElementById("order_items").value = "Cart was empty";
        document.getElementById("order_total").value = "$0.00";
        return;
      }

      emptyNotice.style.display = "none";

      const summary = buildSummary(items);

      // Page summary
      orderSummary.innerHTML =
        "<strong>Order Summary</strong><br>" +
        summary.text.replace(/\n/g, "<br>") +
        "<br><br><strong>Total:</strong> " + formatMoney(summary.total);

      // Email fields (these will show in FormSubmit email)
      document.getElementById("order_items").value = summary.text;
      document.getElementById("order_total").value = formatMoney(summary.total);
    }

    // Fill immediately on load
    syncOrderFields();

    // Ensure fields are filled right before submit too
    document.getElementById("checkoutForm").addEventListener("submit", function () {
      syncOrderFields();
    });
  </script>

  <!-- Your existing script (can stay) -->
  <script src="js/checkout.js"></script>
</body>
</html>
